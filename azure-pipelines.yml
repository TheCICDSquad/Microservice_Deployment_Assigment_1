trigger:
  - main

pool:
  name: Linux_Agent

variables:
  DOCKER_REPO: 'sashangykumar456/petclinic'  # Just the repo name
  IMAGE_TAG: '$(Build.BuildId)'
  DOCKERFILE_PATH: 'Microservice_Deployment_Assigment_1/DockerFile/'
  APP_PATH: 'Microservice_Deployment_Assigment_1/app'

steps:
  - script: |
      sudo apt update
      sudo apt install -y python3 python3-pip
      python3 --version
      pip3 --version
    displayName: 'Install Python via APT'

  - script: |
      cd $(APP_PATH)
      pip3 install -r requirements.txt  # Optional: only if needed
    displayName: 'Install Python dependencies (if any)'

  - task: DockerInstaller@0
    displayName: 'Install Docker CLI'

  - task: Docker@2
    displayName: 'Login to Docker Hub'
    inputs:
      command: login
      containerRegistry: 'dockerHubService'  # Replace with your Docker service connection

  - script: |
      cd $(DOCKERFILE_PATH)
      docker build -t $(DOCKER_REPO):$(IMAGE_TAG) .
    displayName: 'Build Docker Image from Dockerfile path'

  - script: |
      docker push $(DOCKER_REPO):$(IMAGE_TAG)
    displayName: 'Push Docker Image to Docker Hub'
