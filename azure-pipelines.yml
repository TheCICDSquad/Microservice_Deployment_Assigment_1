trigger:
- main

pool:
  name: 'Linux_Agent'  # Your pool with Python 3.12.3

steps:
- checkout: self  # Ensures your code is properly checked out

- script: |
    cd $(Build.SourcesDirectory)/Microservice_Deployment_Assigment_1/app/
    
    echo "Creating virtual environment..."
    python3 -m venv venv
    source venv/bin/activate

    echo "Installing dependencies..."
    pip install --upgrade pip
    pip install -r requirements.txt

    echo "Running FastAPI app..."
    uvicorn main:app --host 0.0.0.0 --port 8000
  displayName: 'Run FastAPI application'


# # 3. Setup Python environment
# - script: |
#     # Create virtual environment
#     python3.12 -m venv .venv
#     source .venv/bin/activate
    
#     # Install dependencies
#     cd Microservice_Deployment_Assigment_1/app
#     pip install -r requirements.txt
    
#     # Run application
#     python main.py
#   displayName: 'Run FastAPI application'

# 2. Docker build (only if you need it)
- task: Docker@2
  displayName: 'Build Docker image'
  inputs:
    command: 'build'
    repository: 'your-app-name'
    dockerfile: 'Microservice_Deployment_Assigment_1/app/Dockerfile'
    tags: 'latest'