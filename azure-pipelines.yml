trigger:
  branches:
    include:
      - main

pool:
  vmImage: 'ubuntu-latest'

variables:
  imageName: 'sashangykumar456/python'
  tag: 'latest'
  imageFullName: 'sashangykumar456/python:latest'

stages:
  - stage: Build
    displayName: 'Build Stage'
    jobs:
      - job: BuildJob
        displayName: 'Build Docker Image'
        steps:

          - checkout: self

          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.x'
              addToPath: true

          - script: |
              echo "Current directory:"
              pwd
              echo "Files in app directory:"
              ls -l app/
            displayName: 'Debug: Show Directory Contents'

          - script: |
              pip install -r app/requirements.txt
            displayName: 'Install Python Dependencies'

          - script: |
              docker build -t $(imageFullName) ./app
            displayName: 'Build Docker Image'

          - script: |
              echo $(DOCKER_PASSWORD) | docker login -u $(DOCKER_USERNAME) --password-stdin
              docker push $(imageFullName)
            displayName: 'Push Docker Image'
            env:
              DOCKER_USERNAME: $(DOCKER_USERNAME)
              DOCKER_PASSWORD: $(DOCKER_PASSWORD)
