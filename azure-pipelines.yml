trigger:
- main

pool:
  name: 'Linux_Agent'  # Your pool with Python 3.12.3

steps:
# 1. Checkout your code from GitHub
- checkout: self
  displayName: 'Checkout repository'

# 2. Verify repository structure (for debugging)
- script: |
    ls -R
    pwd
    python3.12 -m venv .venv
    source .venv/bin/activate
    
    # Install requirements directly using full path
    pip install -r $(System.DefaultWorkingDirectory)/Microservice_Deployment_Assignment_1/app/requirements.txt
    
    # Run the application using full path
    python $(System.DefaultWorkingDirectory)/Microservice_Deployment_Assignment_1/app/main.py
  displayName: 'Verify repository structure'

# # 3. Setup Python environment
# - script: |
#     # Create virtual environment
#     python3.12 -m venv .venv
#     source .venv/bin/activate
    
#     # Install dependencies
#     cd Microservice_Deployment_Assigment_1/app
#     pip install -r requirements.txt
    
#     # Run application
#     python main.py
#   displayName: 'Run FastAPI application'

# 2. Docker build (only if you need it)
- task: Docker@2
  displayName: 'Build Docker image'
  inputs:
    command: 'build'
    repository: 'your-app-name'
    dockerfile: 'Microservice_Deployment_Assigment_1/app/Dockerfile'
    tags: 'latest'