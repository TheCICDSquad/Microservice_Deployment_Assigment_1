trigger:
  branches:
    include:
      - main  # or your working branch

pool:
  name: Linux_Agent

variables:
  dockerRegistryServiceConnection: '<your-service-connection-name>'  # Azure container registry connection
  imageRepository: 'my-python-app'   # Name of your Docker image
  containerRegistry: '<your-registry-name>.azurecr.io'  # Your Azure Container Registry name
  tag: '$(Build.BuildId)'

stages:
- stage: Build
  displayName: Build and Package
  jobs:
  - job: BuildDockerImage
    displayName: Build Docker Image
    steps:

    - task: UsePythonVersion@0
      inputs:
        versionSpec: '3.x'
        addToPath: true

    - task: PythonScript@0
      displayName: Install Dependencies
      inputs:
        scriptSource: 'inline'
        script: |
          cd Microservice_Deployment_Assigment_1/app/
          pip install -r requirements.txt

    # - task: Docker@2
    #   displayName: Build and Push Docker Image
    #   inputs:
    #     containerRegistry: '$(dockerRegistryServiceConnection)'
    #     repository: '$(imageRepository)'
    #     command: 'buildAndPush'
    #     Dockerfile: 'Microservice_Deployment_Assigment_1/app/Dockerfile'
    #     tags: |
    #       $(tag)
