trigger:
  branches:
    include:
      - main  
pool:
  name: Linux_Agent

variables:
  imageName: sashangykumar456/python
  imageTag: latest
  imageFullName: $(imageName):$(imageTag)

stages:
  - stage: BuildAndPush
    jobs:
      - job: BuildAndPushDockerImage
        steps:

          # Optional: Show current directory structure for debugging
          - script: |
              echo "Showing repo structure:"
              ls -R
            displayName: "Debug: List files"

          # Login to Docker Hub
          - script: |
              echo "$(DOCKER_PASSWORD)" | docker login -u "$(DOCKER_USERNAME)" --password-stdin
            displayName: "Docker Login"

          # Build Docker image (assumes Dockerfile is under /Microservice_Deployment_Assigment_1/app/)
          - script: |
              cd Microservice_Deployment_Assigment_1/app/
              docker build -t $(imageFullName) .
            displayName: "Build Docker Image"

          # Push Docker image to Docker Hub
          - script: |
              docker push $(imageFullName)
            displayName: "Push Docker Image"
