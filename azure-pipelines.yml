trigger:
  - main  # or your main branch name

pool:
  name: Linux_Agent

variables:
  DOCKER_REPO: 'https://hub.docker.com/repository/docker/sashangykumar456/petclinic'  # Change this
  IMAGE_TAG: '$(Build.BuildId)'

steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '3.x'
      addToPath: true

  - script: |
      python --version
    displayName: 'Verify Python Installed'

  - task: DockerInstaller@0
    displayName: 'Install Docker CLI'

  - task: Docker@2
    displayName: 'Login to Docker Hub'
    inputs:
      command: login
      containerRegistry: 'dockerHubService'  # OR use username/password below

  # If you're not using a Docker service connection, use this instead:
  # - script: echo $(DOCKER_PASSWORD) | docker login -u $(DOCKER_USERNAME) --password-stdin
  #   displayName: 'Docker Login (Manual)'

  - script: |
      docker build -t $(DOCKER_REPO):$(IMAGE_TAG) .
    displayName: 'Build Docker Image'

  - script: |
      docker push $(DOCKER_REPO):$(IMAGE_TAG)
    displayName: 'Push Docker Image to Docker Hub'
